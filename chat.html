<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat - MediQA Chatbot</title>

  <link rel="stylesheet" href="style.css">

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü©∫</text></svg>">
</head>

<body class="chat-page">
  <div class="chat-container">

    <!-- Sidebar -->
    <aside class="chat-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <span class="medical-icon">‚öïÔ∏è</span>
          <span>MediQA</span>
        </div>
      </div>

      <!-- Static placeholder since Flask loops don‚Äôt work -->
      <div class="chat-history">
        <h3 class="history-title">Chat History</h3>
        <div class="history-list">
          <p class="no-history">Chat history unavailable in static mode.</p>
        </div>
      </div>

      <div class="sidebar-footer" style="padding-top:12px;">
        <a href="index.html" class="logout-btn" style="
          display:inline-block;
          padding:8px 12px;
          border-radius:10px;
          background:rgba(255,0,0,0.06);
          color:#ff6b6b;
          text-decoration:none;">
          üö™ Exit
        </a>
      </div>
    </aside>

    <!-- Main -->
    <main class="chat-main" style="flex:1;display:flex;flex-direction:column;min-height:100vh;">

      <div class="chat-header" style="padding:1.2rem 1.6rem;background:rgba(10,25,41,0.95);border-bottom:2px solid rgba(13,202,240,0.06);display:flex;justify-content:space-between;align-items:center;">
        <h2 class="chat-title" style="margin:0;background:var(--gradient-1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">
          AI Health Assistant
        </h2>

        <button class="new-chat-btn" onclick="startNewChat()">
          ‚ûï New Chat
        </button>
      </div>

      <!-- Messages -->
      <div id="chat-box" class="chat-messages" style="flex:1;overflow-y:auto;">
        <!-- Default bot greeting -->
        <div class="message bot-message">
          <div class="message-avatar bot-avatar">ü§ñ</div>
          <div class="message-content">
            <p>Hello! I'm your AI Health Assistant. How can I help you today?</p>
          </div>
        </div>
      </div>

      <!-- Input -->
      <div class="chat-input-container">
        <form id="chat-form" class="chat-input-form">
          <input type="text" id="question" class="chat-input" placeholder="Type your health question here..." autocomplete="off" required />
          <button type="submit" class="send-btn"><span class="send-icon">üì§</span></button>
        </form>
      </div>

    </main>
  </div>
<!-- 
<script>
let currentChatId = ""; // Flask removed ‚Üí use empty string

function startNewChat() {
  currentChatId = "";
  document.getElementById("chat-box").innerHTML = `
    <div class="message bot-message"> 
      <div class="message-avatar bot-avatar">ü§ñ</div>
      <div class="message-content"><p>New chat started. How can I help?</p></div>
    </div>`;
}

document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("chat-form");
  const input = document.getElementById("question");
  const chatBox = document.getElementById("chat-box");

  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    const question = input.value.trim();
    if (!question) return;

    // user message
    const userDiv = document.createElement("div");
    userDiv.className = "message user-message";
    userDiv.innerHTML = `
      <div class="message-content"><p>${escapeHtml(question)}</p></div>
      <div class="message-avatar user-avatar">üë§</div>`;
    chatBox.appendChild(userDiv);

    chatBox.scrollTop = chatBox.scrollHeight;
    input.value = "";

    // typing indicator
    const typing = document.createElement("div");
    typing.className = "message bot-message thinking";
    typing.innerHTML = `
      <div class="message-avatar bot-avatar">ü§ñ</div>
      <div class="message-content">
        <div class="typing-indicator"><span></span><span></span><span></span></div>
        <p>Thinking...</p>
      </div>`;
    chatBox.appendChild(typing);
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
      const res = await fetch("https://backend-chatbot-h3ui.onrender.com/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question, chat_id: currentChatId })
      });

      const data = await res.json();

      typing.remove();

      // bot response
      const botDiv = document.createElement("div");
      botDiv.className = "message bot-message";
      botDiv.innerHTML = `
        <div class="message-avatar bot-avatar">ü§ñ</div>
        <div class="message-content"><p>${escapeHtml(data.answer)}</p></div>`;
      chatBox.appendChild(botDiv);

      chatBox.scrollTop = chatBox.scrollHeight;

    } catch (err) {
      typing.remove();
      const errDiv = document.createElement("div");
      errDiv.className = "message bot-message";
      errDiv.innerHTML = `
        <div class="message-avatar bot-avatar">ü§ñ</div>
        <div class="message-content"><p>Error. Try again.</p></div>`;
      chatBox.appendChild(errDiv);
    }
  });

  function escapeHtml(text) {
    return text.replace(/[&<>"'`=\/]/g, s => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;',
      "'": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;'
    }[s]));
  }
});
</script> -->
  <script src="javascript.js"></script>

</body>
</html>
